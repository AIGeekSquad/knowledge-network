<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Foundation Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-result {
      padding: 0.5rem;
      border-radius: 4px;
      margin-top: 0.5rem;
    }
    .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .pending { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin: 0.25rem;
    }
    button:hover { background: #5a6fd8; }
    #console-output {
      background: #2d3748;
      color: #e2e8f0;
      font-family: monospace;
      font-size: 0.875rem;
      padding: 1rem;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Knowledge Network Demo Suite - Foundation Test</h1>

  <div class="test-section">
    <h2>Environment Checks</h2>
    <div id="env-checks">
      <div class="test-result pending">Running environment checks...</div>
    </div>
  </div>

  <div class="test-section">
    <h2>Module Loading</h2>
    <div id="module-tests">
      <div class="test-result pending">Testing module imports...</div>
    </div>
  </div>

  <div class="test-section">
    <h2>Navigation Testing</h2>
    <div id="nav-tests">
      <button onclick="testRouter()">Test Router</button>
      <button onclick="testStateManagement()">Test State Management</button>
      <button onclick="testPerformanceMonitor()">Test Performance Monitor</button>
      <div class="test-result pending">Click buttons to run tests</div>
    </div>
  </div>

  <div class="test-section">
    <h2>UI Components Testing</h2>
    <div id="ui-tests">
      <button onclick="testUIComponents()">Test UI Components</button>
      <div class="test-result pending">Click button to test UI components</div>
    </div>
  </div>

  <div class="test-section">
    <h2>Console Output</h2>
    <div id="console-output"></div>
  </div>

  <script type="module">
    // Capture console output
    const consoleOutput = document.getElementById('console-output');
    const originalLog = console.log;
    const originalError = console.error;

    console.log = (...args) => {
      originalLog(...args);
      consoleOutput.textContent += '[LOG] ' + args.join(' ') + '\n';
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };

    console.error = (...args) => {
      originalError(...args);
      consoleOutput.textContent += '[ERROR] ' + args.join(' ') + '\n';
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };

    // Test utilities
    function updateTestResult(containerId, message, status) {
      const container = document.getElementById(containerId);
      const result = container.querySelector('.test-result');
      result.textContent = message;
      result.className = `test-result ${status}`;
    }

    // Environment checks
    function runEnvironmentChecks() {
      const checks = [
        { name: 'Canvas 2D Context', test: () => !!document.createElement('canvas').getContext },
        { name: 'ResizeObserver', test: () => typeof ResizeObserver !== 'undefined' },
        { name: 'URLSearchParams', test: () => typeof URLSearchParams !== 'undefined' },
        { name: 'RequestAnimationFrame', test: () => typeof requestAnimationFrame !== 'undefined' },
        { name: 'ES6+ Features', test: () => {
          try {
            new Function('const test = () => {}; class Test {}; new Promise(() => {});')();
            return true;
          } catch { return false; }
        }}
      ];

      let passed = 0;
      const results = checks.map(check => {
        const result = check.test();
        if (result) passed++;
        return `${check.name}: ${result ? '✓ PASS' : '✗ FAIL'}`;
      });

      updateTestResult('env-checks',
        `Environment checks: ${passed}/${checks.length} passed\n` + results.join('\n'),
        passed === checks.length ? 'pass' : 'fail'
      );
    }

    // Module loading tests
    async function testModuleLoading() {
      try {
        console.log('Testing module imports...');

        // Test individual module imports
        const utils = await import('./src/shared/utils.js');
        console.log('✓ Utils module loaded');

        const { EventEmitter } = utils;
        const emitter = new EventEmitter();
        emitter.on('test', (data) => console.log('Event received:', data));
        emitter.emit('test', 'Hello World');
        console.log('✓ EventEmitter working');

        const dataGen = await import('./src/shared/DataGenerator.js');
        console.log('✓ DataGenerator module loaded');

        const generator = new dataGen.DataGenerator(42);
        const graph = generator.generateGraph('random', {
          nodeCount: 10,
          width: 400,
          height: 300
        });
        console.log('✓ Graph generation working, nodes:', graph.nodes.length);

        updateTestResult('module-tests', 'All modules loaded successfully', 'pass');
      } catch (error) {
        console.error('Module loading failed:', error);
        updateTestResult('module-tests', 'Module loading failed: ' + error.message, 'fail');
      }
    }

    // Navigation testing
    window.testRouter = async function() {
      try {
        console.log('Testing NavigationRouter...');

        const nav = await import('./src/shared/NavigationRouter.js');
        const router = new nav.NavigationRouter();

        console.log('✓ Router created');

        // Test route registration
        router.registerRoute('/test', async () => ({
          id: 'test',
          title: 'Test Module',
          difficulty: 'beginner',
          initialize: async () => {},
          render: async () => {},
          cleanup: () => {},
          getConfigurationOptions: () => [],
          getCodeExamples: () => []
        }));

        console.log('✓ Route registered');
        console.log('✓ Router tests passed');

        updateTestResult('nav-tests', 'Router: ✓ PASS', 'pass');
      } catch (error) {
        console.error('Router test failed:', error);
        updateTestResult('nav-tests', 'Router: ✗ FAIL - ' + error.message, 'fail');
      }
    };

    // State management testing
    window.testStateManagement = async function() {
      try {
        console.log('Testing state management...');

        const utils = await import('./src/shared/utils.js');
        const { EventEmitter } = utils;

        const stateManager = new EventEmitter();
        let eventReceived = false;

        stateManager.on('stateChange', (data) => {
          eventReceived = true;
          console.log('State change received:', data);
        });

        stateManager.emit('stateChange', { test: true });

        if (eventReceived) {
          console.log('✓ State management working');
          updateTestResult('nav-tests', 'State Management: ✓ PASS', 'pass');
        } else {
          throw new Error('Event not received');
        }
      } catch (error) {
        console.error('State management test failed:', error);
        updateTestResult('nav-tests', 'State Management: ✗ FAIL - ' + error.message, 'fail');
      }
    };

    // Performance monitor testing
    window.testPerformanceMonitor = async function() {
      try {
        console.log('Testing PerformanceMonitor...');

        const perf = await import('./src/shared/PerformanceMonitor.js');
        const monitor = new perf.PerformanceMonitor();

        console.log('✓ PerformanceMonitor created');

        const metrics = monitor.getCurrentMetrics();
        console.log('✓ Metrics retrieved:', metrics.fps, 'fps');

        updateTestResult('nav-tests', 'Performance Monitor: ✓ PASS', 'pass');
      } catch (error) {
        console.error('Performance monitor test failed:', error);
        updateTestResult('nav-tests', 'Performance Monitor: ✗ FAIL - ' + error.message, 'fail');
      }
    };

    // UI components testing
    window.testUIComponents = async function() {
      try {
        console.log('Testing UI Components...');

        const ui = await import('./src/shared/UIComponents.js');
        const { Button, Slider, Panel } = ui;

        console.log('✓ UI components imported');

        // Test button
        const button = new Button('Test Button');
        document.body.appendChild(button.getElement());
        console.log('✓ Button created and added to DOM');

        // Test slider
        const slider = new Slider({
          label: 'Test Slider',
          min: 0,
          max: 100,
          value: 50
        });
        document.body.appendChild(slider.getElement());
        console.log('✓ Slider created and added to DOM');

        // Test panel
        const panel = new Panel({
          title: 'Test Panel',
          collapsible: true
        });
        document.body.appendChild(panel.getElement());
        console.log('✓ Panel created and added to DOM');

        updateTestResult('ui-tests', 'UI Components: ✓ PASS', 'pass');
      } catch (error) {
        console.error('UI components test failed:', error);
        updateTestResult('ui-tests', 'UI Components: ✗ FAIL - ' + error.message, 'fail');
      }
    };

    // Run initial tests
    console.log('Starting foundation tests...');
    runEnvironmentChecks();
    testModuleLoading();
  </script>
</body>
</html>