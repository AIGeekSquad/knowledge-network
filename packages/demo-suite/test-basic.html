<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Basic Performance Test</title>
  <style>
    body {
      background: #1a1d20;
      color: white;
      font-family: monospace;
      padding: 20px;
    }
    #container {
      width: 500px;
      height: 300px;
      border: 2px solid #107c10;
      position: relative;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h2 style="color: #107c10;">FPS Test</h2>
  <p>Should see performance overlay in container. Double-click to toggle details.</p>

  <div id="container"></div>

  <script type="module">
    // Inline FPS calculator to avoid import issues
    class FPSCalculator {
      constructor() {
        this.frameHistory = [];
        this.isRunning = false;
        this.lastFrameTime = 0;
      }

      start() {
        this.isRunning = true;
        this.lastFrameTime = performance.now();
        this.frameHistory = [];
      }

      recordFrame() {
        if (!this.isRunning) return;
        const currentTime = performance.now();
        const frameTime = currentTime - this.lastFrameTime;
        this.frameHistory.push(frameTime);
        if (this.frameHistory.length > 60) {
          this.frameHistory.shift();
        }
        this.lastFrameTime = currentTime;
      }

      getCurrentFPS() {
        if (this.frameHistory.length < 2) return 0;
        const avgFrameTime = this.frameHistory.reduce((sum, time) => sum + time, 0) / this.frameHistory.length;
        return Math.floor((1000 / avgFrameTime) * 10) / 10;
      }

      getFrameTime() {
        return this.frameHistory.length > 0 ?
          this.frameHistory[this.frameHistory.length - 1] : 0;
      }
    }

    // Simple overlay
    class PerformanceOverlay {
      constructor(container) {
        this.container = container;
        this.isDetailed = false;
      }

      initialize() {
        this.overlay = document.createElement('div');
        this.overlay.style.cssText = `
          position: absolute;
          top: 10px;
          right: 10px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 10px;
          border-radius: 4px;
          font-family: monospace;
          font-size: 12px;
          cursor: pointer;
          user-select: none;
          z-index: 1000;
          border: 1px solid #107c10;
        `;

        this.overlay.innerHTML = `
          <div>FPS: <span id="fps-value">--</span></div>
          <div>Frame: <span id="frame-time">--</span>ms</div>
          <div id="detailed-metrics" style="display: none;">
            <hr style="margin: 5px 0; border-color: #107c10;">
            <div>Status: Running</div>
            <small style="color: #aaa;">Double-click to toggle</small>
          </div>
        `;

        this.container.appendChild(this.overlay);

        // Add double-click handler
        this.overlay.addEventListener('dblclick', () => {
          this.toggleDetails();
        });

        // Visual feedback
        this.overlay.addEventListener('mouseenter', () => {
          this.overlay.style.background = 'rgba(16, 124, 16, 0.9)';
        });

        this.overlay.addEventListener('mouseleave', () => {
          this.overlay.style.background = 'rgba(0, 0, 0, 0.8)';
        });
      }

      toggleDetails() {
        this.isDetailed = !this.isDetailed;
        const details = this.overlay.querySelector('#detailed-metrics');
        details.style.display = this.isDetailed ? 'block' : 'none';
        console.log('Toggle details:', this.isDetailed);
      }

      updateMetrics(fps, frameTime) {
        const fpsEl = this.overlay.querySelector('#fps-value');
        const frameEl = this.overlay.querySelector('#frame-time');
        if (fpsEl) fpsEl.textContent = fps.toString();
        if (frameEl) frameEl.textContent = frameTime.toFixed(1);
      }
    }

    // Initialize everything
    const container = document.getElementById('container');
    if (!container) {
      console.error('Container not found');
    } else {
      const fpsCalc = new FPSCalculator();
      const overlay = new PerformanceOverlay(container);

      overlay.initialize();
      fpsCalc.start();

      console.log('Starting FPS monitoring...');

      // Animation loop
      function loop() {
        fpsCalc.recordFrame();
        const fps = fpsCalc.getCurrentFPS();
        const frameTime = fpsCalc.getFrameTime();
        overlay.updateMetrics(fps, frameTime);
        requestAnimationFrame(loop);
      }

      requestAnimationFrame(loop);
    }
  </script>
</body>
</html>